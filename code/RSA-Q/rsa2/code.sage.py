

# This file was *autogenerated* from the file code.sage
from sage.all_cmdline import *   # import sage library

_sage_const_0 = Integer(0); _sage_const_1 = Integer(1); _sage_const_2 = Integer(2); _sage_const_4 = Integer(4); _sage_const_101991809777553253470276751399264740131157682329252673501792154507006158434432009141995367241962525705950046253400188884658262496534706438791515071885860897552736656899566915731297225817250639873643376310103992170646906557242832893914902053581087502512787303322747780420210884852166586717636559058152544979471 = Integer(101991809777553253470276751399264740131157682329252673501792154507006158434432009141995367241962525705950046253400188884658262496534706438791515071885860897552736656899566915731297225817250639873643376310103992170646906557242832893914902053581087502512787303322747780420210884852166586717636559058152544979471); _sage_const_46731919563265721307105180410302518676676135509737992912625092976849075262192092549323082367518264378630543338219025744820916471913696072050291990620486581719410354385121760761374229374847695148230596005409978383369740305816082770283909611956355972181848077519920922059268376958811713365106925235218265173085 = Integer(46731919563265721307105180410302518676676135509737992912625092976849075262192092549323082367518264378630543338219025744820916471913696072050291990620486581719410354385121760761374229374847695148230596005409978383369740305816082770283909611956355972181848077519920922059268376958811713365106925235218265173085)
# Copy this to a .sage file or SageMath cell
def wiener_attack(e, n):
    print(f"[*] Testing Wiener's Attack...")
    # 1. 将 e/n 展开为连分数
    # SageMath 的 continued_fraction 处理大数非常快
    cf = continued_fraction(Integer(e)/Integer(n))
    
    # 2. 循环遍历每一个渐进分数 k/d
    for frac in cf.convergents():
        k = frac.numerator()
        d = frac.denominator()
        
        if k == _sage_const_0 : continue
        
        # 3. 验证 d 是否正确
        # phi = (ed - 1) / k
        if (e * d - _sage_const_1 ) % k != _sage_const_0 :
            continue
            
        phi = (e * d - _sage_const_1 ) // k
        
        # 4. 构建一元二次方程 x^2 - ((n - phi) + 1)x + n = 0
        # 如果方程有整数根 (p, q)，说明 d 是正确的
        # 判别式 delta = b^2 - 4ac
        b = -(n - phi + _sage_const_1 )
        delta = b**_sage_const_2  - _sage_const_4  * n
        
        if delta >= _sage_const_0  and is_square(delta):
            # 找到解了！
            print(f"[+] Success! Found d: {d}")
            
            # 如果需要求 p 和 q
            # p = (-b + sqrt(delta)) / 2
            # q = (-b - sqrt(delta)) / 2
            # print(f"p: {(-b + sqrt(delta)) // 2}")
            # print(f"q: {(-b - sqrt(delta)) // 2}")
            
            return d
            
    print("[-] Wiener's Attack failed. d might be larger.")
    return None

# ==========================================
# 在这里填入你的题目数据
n = _sage_const_101991809777553253470276751399264740131157682329252673501792154507006158434432009141995367241962525705950046253400188884658262496534706438791515071885860897552736656899566915731297225817250639873643376310103992170646906557242832893914902053581087502512787303322747780420210884852166586717636559058152544979471 
e = _sage_const_46731919563265721307105180410302518676676135509737992912625092976849075262192092549323082367518264378630543338219025744820916471913696072050291990620486581719410354385121760761374229374847695148230596005409978383369740305816082770283909611956355972181848077519920922059268376958811713365106925235218265173085 

d = wiener_attack(e, n)
print(d)

